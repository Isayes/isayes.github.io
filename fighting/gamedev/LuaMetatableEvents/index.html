<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title># Lua Metatable Events # | Notes.HF</title>
  <meta name="author" content="HuFei">
  
  <meta name="description" content="Notes of Daily Learning">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="# Lua Metatable Events #"/>
  <meta property="og:site_name" content="Notes.HF"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Notes.HF" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>

<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Notes.HF</a></h1>
  <h2><a href="/">notes of buaaGS1521AA9.hufei | personal website | 3D Game Developer</a></h2>
</div>
<nav id="main-nav">
  <ul>
    
      <li><a href="/fighting/gamedev">Game Development</a></li>
    
      <li><a href="/fighting/finance">Finance Knowlodge</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
<div class="alignleft" style="margin-top: 15px">


  <iframe src="http://ghbtns.com/github-btn.html?user=Isayes&type=follow"
  allowtransparency="true" frameborder="0" scrolling="0" width="132" height="20"></iframe>

</div>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="wrapper"><article class="page">
  
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/fighting/gamedev/LuaMetatableEvents/index.html"># Lua Metatable Events #</a></h1>
  

      
    </header>
    <div class="entry">
      
        <figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--- # Metatable Events</span></span><br><span class="line"><span class="comment">--- A listing of all the 'special' keys in a metatable, and the metamethods which they perform.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--[[</span><br><span class="line"></span><br><span class="line">(1) __index</span><br><span class="line"></span><br><span class="line">Control 'prototype' inheritance. When accessing "myTable[key]" and the key does not appear in the table, but the</span><br><span class="line">metatable has an __index property:</span><br><span class="line"></span><br><span class="line">    - if the value is a function, the function is called, passing in the table and the key; the return value of that</span><br><span class="line">    function is returned as the result.</span><br><span class="line"></span><br><span class="line">    - if the value is another table, the value of the key in that table is asked for and returned (and if it does not</span><br><span class="line">    exist in that table, but that table's metatable has an __index property, then it continues on up.)</span><br><span class="line"></span><br><span class="line">    - Use "rawget(myTable,key)" to skip this metamethod.</span><br><span class="line"></span><br><span class="line">(2) __newindex</span><br><span class="line"></span><br><span class="line">Control property assignment. When calling "myTable[key] = value", if the metatable has a __newindex key pointing to a</span><br><span class="line">function, call that function, passing it the table, key, and value.</span><br><span class="line"></span><br><span class="line">    - Use "rawset(myTable,key,value)" to skip this metamethod.</span><br><span class="line">    - if the __newindex function does not set the key on the table(using rawset) then the key/value pair is not added</span><br><span class="line">    to myTable.</span><br><span class="line"></span><br><span class="line">(3) __mode</span><br><span class="line"></span><br><span class="line">Control weak references. A string value with one or both of the characters 'k' and 'v' which specifies that the keys</span><br><span class="line">and/or values in the table are weak references.</span><br><span class="line"></span><br><span class="line">(4) __call</span><br><span class="line"></span><br><span class="line">Treat a table like a function. When a table is followed by parenthesis such as "myTable('foo')" and the metatable has a</span><br><span class="line">__call key pointing to a function, that function is invoked (passing the table as the first argument, followd by any</span><br><span class="line">specified arguments) and the return value is returned.</span><br><span class="line"></span><br><span class="line">(5) __metatable</span><br><span class="line"></span><br><span class="line">Hide the metatable. When "getmetatable(myTable)" is called, if the metatable for myTable has a __metatable key, the</span><br><span class="line">value of that key is returned instead of the actual metatable.</span><br><span class="line"></span><br><span class="line">(6) __tostring</span><br><span class="line"></span><br><span class="line">Control string representation. When the builtin "tostring(myTable)" function is called, if the metatable for myTable has</span><br><span class="line">a __tostring property set to a function, that function is invoked(passing myTable to it) and the return value is used as</span><br><span class="line">the string representation.</span><br><span class="line"></span><br><span class="line">(7) __len</span><br><span class="line"></span><br><span class="line">Control table length. When the table length is requested using the length operator('#'), if the metatable for myTable</span><br><span class="line">has a __len key pointing to a function, that function is invoked(passing myTable to it) and the return value used as the</span><br><span class="line">value of "#myTable".</span><br><span class="line"></span><br><span class="line">(8) __gc</span><br><span class="line"></span><br><span class="line">Userdata finalizer code, when usedata is set to be garbage collected, if the metatable has a __gc field pointing to a</span><br><span class="line">function, that function is first invoked, passing the userdata to it. The __gc metamethod is not called for tables.</span><br><span class="line"></span><br><span class="line">--]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--- Mathematic Operators</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--[[</span><br><span class="line"></span><br><span class="line">    __unm : Unary minus. When writing "-myTable", if the metatable has a __unm key pointing to a function, that</span><br><span class="line">    function, that function is invoked(passing the table), and the return value used as the value of "-myTable".</span><br><span class="line"></span><br><span class="line">    __add : Addition. When writing "myTable + object" or "object + myTable", if myTable's metatable has an __add key</span><br><span class="line">    pointing to a function, that function is invoked(passing the left and right operands in order) and the return value</span><br><span class="line">    used.</span><br><span class="line">    if both operands are tables, the left table is checked before the right table for the presence of an _add metaevent.</span><br><span class="line"></span><br><span class="line">    __sub : Subtraction. Invoked similar to addition, using the "-" operator.</span><br><span class="line"></span><br><span class="line">    __mul : Multiplication. Invoked similar to addtion, using the "*" operator.</span><br><span class="line"></span><br><span class="line">    __div : Division. Invoked similar to addtion, using the "/" operator.</span><br><span class="line"></span><br><span class="line">    __idiv : (Lua 5.3) Floor division, division with rounding down to nearest integer. "//" operator.</span><br><span class="line"></span><br><span class="line">    __mod : Modulo. Invoked similar to addition, using the "%" operator.</span><br><span class="line"></span><br><span class="line">    __pow : Involution. Invoked similar to addition, using the "^" operator.</span><br><span class="line"></span><br><span class="line">    __concat : Concatenation. Invoked similar to addition, using the '..' operator.</span><br><span class="line"></span><br><span class="line">--]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--- Bitwise Operator</span></span><br><span class="line"><span class="comment">--- Lua 5.3 introduced the ability to use true integers, and with it bitwise operations. These operations are invoked</span></span><br><span class="line"><span class="comment">--- similar to the addition operation, except that Lua will try a metamethod if any operand is neither an integer nor a</span></span><br><span class="line"><span class="comment">--- value coercible to an integer.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--[[</span><br><span class="line"></span><br><span class="line">    __band : the bitwise AND &amp; operation</span><br><span class="line">    __bor : the bitwise OR | operation</span><br><span class="line">    __bxor : the bitwise exclusive OR (binary ~) operation</span><br><span class="line">    __bnot : the bitwise NOT(unary ~) operation</span><br><span class="line">    __bshl : the bitwise left shift(&lt;&lt;) operation</span><br><span class="line">    __bshr : the bitwise right shift(&gt;&gt;) operation</span><br><span class="line"></span><br><span class="line">--]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--- Equivlence Comparison Operators</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--- __eq : Check for equality. This method is invoked when "myTable1 == myTable2" is evaluated, but only if both tables</span></span><br><span class="line"><span class="comment">--- have the exact same metamethod for __eq.</span></span><br><span class="line"><span class="comment">-- For example, see the following code:</span></span><br><span class="line"></span><br><span class="line">tla = &#123;&#125;</span><br><span class="line">tlb = &#123;&#125;</span><br><span class="line">t2 = &#123;&#125;</span><br><span class="line">mt1 = &#123; __eq = <span class="function"><span class="keyword">function</span><span class="params">(o1, o2)</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'whee'</span></span><br><span class="line"><span class="keyword">end</span> &#125;</span><br><span class="line">mt2 = &#123; __eq = <span class="function"><span class="keyword">function</span><span class="params">(o1, o2)</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"whee"</span></span><br><span class="line"><span class="keyword">end</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setmetatable</span>(tla, mt1)</span><br><span class="line"><span class="built_in">setmetatable</span>(tlb, mt1)</span><br><span class="line"><span class="built_in">setmetatable</span>(t2, mt2)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(tla == tlb) <span class="comment">--&gt; true</span></span><br><span class="line"><span class="built_in">print</span>(tla == t2) <span class="comment">--&gt; false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- If the function returns nil or false, the result of the comparison is false; otherwise, the result is true.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- If t1 and t2 are referencing the same table, the __eq method is not invoked for t1 == t2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">(o1, o2)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'__eq call'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">t1 = &#123;&#125;</span><br><span class="line"><span class="built_in">setmetatable</span>(t1, &#123; __eq = foo &#125;)</span><br><span class="line"></span><br><span class="line">t2 = t1</span><br><span class="line"><span class="built_in">print</span>(t1 == t2) <span class="comment">--&gt; true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- string '__eq call' not printed(and comparison result is true, not like the return value of foo(...)), so no foo(...) call here</span></span><br><span class="line"></span><br><span class="line">t3 = &#123;&#125;</span><br><span class="line"><span class="built_in">setmetatable</span>(t3, &#123; __eq = foo &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> t1 == t3 <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- __eq call</span></span><br><span class="line">    <span class="comment">-- foo is called</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--- __lt : Check for less-than. Similar to equality, using the '&lt;' operator.</span></span><br><span class="line"><span class="comment">--- Greater-than is evaluated by reversing the order of the operands passed to the __lt function.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- a &gt; b == b &lt; a</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--- __le Check for less-than-or-equal. Similar to equality, using the '&lt;=' operator.</span></span><br><span class="line"><span class="comment">--- Greater-than-or-equal is evaluated by reversing the order of the operands passed to the __le function.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- a&gt;=b == b&lt;=a</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--- end.</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>
<!-- hackish -->
</div>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2017 HuFei
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="http://apps.bdimg.com/libs/fancybox/2.1.5/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>