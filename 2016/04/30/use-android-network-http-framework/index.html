<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title># 使用 HTTP 网络请求库框架 | Notes.HF</title>
  <meta name="author" content="HuFei">
  
  <meta name="description" content="Notes of Daily Learning">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="# 使用 HTTP 网络请求库框架"/>
  <meta property="og:site_name" content="Notes.HF"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Notes.HF" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>

<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Notes.HF</a></h1>
  <h2><a href="/">notes of buaaGS1521AA9.hufei | 用来笔记一下</a></h2>
</div>
<nav id="main-nav">
  <ul>
    
      <li><a href="/more">分类</a></li>
    
      <li><a href="/works">作品</a></li>
    
      <li><a href="http://www.cnblogs.com/isayes">博客</a></li>
    
      <li><a href="http://weibo.com/khufly">微博</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
<div class="alignleft" style="margin-top: 15px">


  <iframe src="http://ghbtns.com/github-btn.html?user=Isayes&type=follow"
  allowtransparency="true" frameborder="0" scrolling="0" width="132" height="20"></iframe>

</div>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="wrapper"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
  
    <h1 class="title"># 使用 HTTP 网络请求库框架</h1>
  

      
        <p class="published">
          Published: <time datetime="2016-04-30T15:39:53.000Z">2016-04-30</time>
        </p>
      
    </header>
    <div class="entry">
      
        <p>关键词：Android / Volley / android-async-http / GET / POST</p>
<p>目前 APP 开发中，HTTP 网络数据交互请求是极其重要并且使用很频繁的一个模块，也是最基本的网络编程所需要学习的。网络请求方式的效率和性能直接影响到 APP 的整体用户体验流畅性，所以学习并掌握一款好的 HTTP 请求框架对我们的网络开发非常重要。<br><a id="more"></a></p>
<p>Http 网络数据交互请求是极其重要并且使用很频繁的一个模块，也是最基本的网络编程所需要学习的。网络请求方式的效率和性能直接影响到 App 的整体用户体验流畅性，所以学习并掌握一款好的 HTTP 请求框架对我们的网络开发非常重要。HTTP 请求在移动网络编程中主要是 GET 和 POST 请求接口的使用。所以，在学好基础的 HTTP 请求知识后，为了提升开发效率，选择学习使用一款好的 HTTP 网络请求框架变得非常重要。</p>
<h2 id="1-Volley-和-Async-http-的各自特点"><a href="#1-Volley-和-Async-http-的各自特点" class="headerlink" title="1. Volley 和 Async-http 的各自特点 #"></a>1. Volley 和 Async-http 的各自特点 #</h2><p>Volley 适合数据量不大但是通信频繁的场景，是 Google I/O 2013 上 Google 官方发布的一款 Android 平台上的网络通信库。以前的网络请求，要考虑开启线程、内存泄漏、性能等等复杂的问题。但是 Volley 框架已经帮我们把这些问题处理好了，对外提供了相应的完善的请求 API，我们只需要按照要求使用即可。</p>
<p>Volley 的特点：  </p>
<ul>
<li>能使网络通信更快，更简单，更健壮</li>
<li>Get / Post 网络请求及网络图像的高效率异步处理请求</li>
<li>可以对网络请求进行排序优先级管理</li>
<li>网络请求的缓存</li>
<li>多级别取消请求</li>
<li>和 Activity 生命周期的联动（Activity 结束时同时取消所有的网络请求）</li>
</ul>
<p>使用 Volley 可以简化一些网络通信的开发，当然 Volley 不适合大数据（large payloads）和流媒体的网络请求。例如上百兆的文件、视频下载。</p>
<p>Async-http 是一款国外的开源框架。高效的网络数据请求，文件下载和上传。</p>
<p>Async-http 的特点：  </p>
<ul>
<li>清晰的网络请求回调</li>
<li>请求使用 ThreadPool，限制并发资源使用情况</li>
<li>GET / POST 基于参数构建使用（RequestParams），方便</li>
<li>Multipart 文件上传，大数据上传下载</li>
<li>自动智能请求重试，优化了质量不一的移动连接</li>
<li>内置响应解析成 JSON，使用 JsonHttpResponseHandler</li>
<li>持久化 cookie 存储，保存 cookie 到你的应用程序的 SharedPreferences</li>
<li>二进制文件（图片等）的下载，使用 BinaryHttpResponseHandler</li>
</ul>
<h2 id="2-Volley-基础用法"><a href="#2-Volley-基础用法" class="headerlink" title="2. Volley 基础用法 #"></a>2. Volley 基础用法 #</h2><p>需要知道以下几点：  </p>
<ol>
<li>Volley 的 Get/Post 请求方式用于服务器间请求和发送数据；  </li>
<li>建立请求首先建立队列，将请求添加到请求队列里，然后进行相应的 Get 和 Post 请求，请求结果在回调里获取解析；</li>
<li>Volley 有自己的请求队列管理机制，可以控制每个请求的建立与取消，非常方便和安全。可以做到随时控制某个请求在什么时候结束；</li>
<li>Activity 生命周期关联，防止无所谓的请求；</li>
<li>当前可用版本：compile ‘com.mcxiaoke.volley:library:1.0.19’</li>
</ol>
<p>MainActivity.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 1. Volley 的 Get 和 Post 请求方式的使用</span><br><span class="line"> * 2. 建立全局的 Volley 网络请求队列（方便管理）</span><br><span class="line"> * 3. 取消队列请求及 Activity 周期关联</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">BaseActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="comment">//volleyGet();</span></span><br><span class="line">        volleyPost();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setupData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        setContentView(R.layout.activity_main, R.string.HomepageTitle, MODE_BACK_ICON);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">volleyGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 查询手机号码的归属地信息 聚合数据 免费 支持HTTPS</span></span><br><span class="line">        String URL = <span class="string">"http://apis.juhe.cn/mobile/get?phone=18796150250&amp;key=af9bfc2857ad3522db215dee9026084f"</span>;</span><br><span class="line">        <span class="comment">// 建立一个请求队列</span></span><br><span class="line">        StringRequest request = <span class="keyword">new</span> StringRequest(</span><br><span class="line">                Request.Method.GET,</span><br><span class="line">                URL,</span><br><span class="line">                <span class="keyword">new</span> Response.Listener&lt;String&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(String response)</span> </span>&#123;</span><br><span class="line">                        showToast(response);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="keyword">new</span> Response.ErrorListener() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onErrorResponse</span><span class="params">(VolleyError error)</span> </span>&#123;</span><br><span class="line">                        showToast(<span class="string">"网络请求失败"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        <span class="comment">// 可以通过标签对请求进行取消</span></span><br><span class="line">        request.setTag(<span class="string">"abcGet"</span>);</span><br><span class="line">        <span class="comment">// 将请求添加到队列里面</span></span><br><span class="line">        MyApplication.getHttpQueue().add(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">volleyPost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String URL = <span class="string">"http://apis.juhe.cn/mobile/get?"</span>;</span><br><span class="line">        StringRequest request = <span class="keyword">new</span> StringRequest(</span><br><span class="line">                Request.Method.POST,</span><br><span class="line">                URL,</span><br><span class="line">                <span class="keyword">new</span> Response.Listener&lt;String&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(String response)</span> </span>&#123;</span><br><span class="line">                        showToast(response);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="keyword">new</span> Response.ErrorListener() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onErrorResponse</span><span class="params">(VolleyError error)</span> </span>&#123;</span><br><span class="line">                        showToast(<span class="string">"请求失败"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> Map&lt;String, String&gt; <span class="title">getParams</span><span class="params">()</span> <span class="keyword">throws</span> AuthFailureError </span>&#123;</span><br><span class="line">                HashMap&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">                map.put(<span class="string">"phone"</span>, <span class="string">"18796150250"</span>);</span><br><span class="line">                map.put(<span class="string">"key"</span>, <span class="string">"af9bfc2857ad3522db215dee9026084f"</span>);</span><br><span class="line">                <span class="keyword">return</span> map;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        request.setTag(<span class="string">"abcPost"</span>);</span><br><span class="line">        MyApplication.getHttpQueue().add(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStop();</span><br><span class="line">        <span class="comment">// 先获取请求队列，在指定取消的某一个请求</span></span><br><span class="line">        MyApplication.getHttpQueue().cancelAll(<span class="string">"abcPost"</span>);</span><br><span class="line">        MyApplication.getHttpQueue().cancelAll(<span class="string">"abcGet"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>BaseActivity.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> MODE_NO_ICON = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> MODE_BACK_ICON = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setupData();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setupData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContentView</span><span class="params">(@LayoutRes <span class="keyword">int</span> layoutResID)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setContentView(layoutResID);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"ConstantConditions"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContentView</span><span class="params">(@LayoutRes <span class="keyword">int</span> layoutResID, <span class="keyword">int</span> titleResID, <span class="keyword">int</span> iconMode)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setContentView(layoutResID);</span><br><span class="line">        Toolbar toolbar = $(R.id.id_toolbar);</span><br><span class="line">        setSupportActionBar(toolbar);</span><br><span class="line">        getSupportActionBar().setDisplayShowTitleEnabled(<span class="keyword">false</span>);</span><br><span class="line">        TextView title = $(R.id.id_pageTitle);</span><br><span class="line">        title.setText(titleResID);</span><br><span class="line">        <span class="keyword">if</span> (iconMode == MODE_BACK_ICON) &#123;</span><br><span class="line">            toolbar.setNavigationIcon(R.drawable.ic_navigate_before_white_24dp);</span><br><span class="line">            toolbar.setNavigationOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">                    finish();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="keyword">protected</span> &lt;T&gt; T $(<span class="keyword">int</span> resId) &#123;</span><br><span class="line">        <span class="keyword">return</span> (T) findViewById(resId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">showToast</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        Toast.makeText(BaseActivity.<span class="keyword">this</span>, msg, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MyApplication.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 建立一个 Volley 的请求队列</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> RequestQueue queue;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        queue = Volley.newRequestQueue(getApplicationContext());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取全局的请求队列</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RequestQueue <span class="title">getHttpQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> queue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-Async-http-的基础用法"><a href="#3-Async-http-的基础用法" class="headerlink" title="3. Async-http 的基础用法 #"></a>3. Async-http 的基础用法 #</h2><p>需要知道以下几点：  </p>
<ol>
<li>Android-async-http 的 Get 和 Post 请求方式的使用，用于与服务器间请求和发送数据；</li>
<li>Android-async-http 回调逻辑的二次封装；</li>
<li>建立请求首先建立请求客户端对象；</li>
<li>然后进行相应的 Get/Post 请求，请求结果在回调里获得解析；</li>
<li>Android-async-http 的 Get/Post 请求可以基于参数化请求（RequestParams），可以清晰方便的将你的请求参数放到里面，然后进行 Get 和 Post 请求；</li>
<li>当前可用版本：compile ‘com.loopj.android:android-async-http:1.4.9’</li>
</ol>
<p>MainActivity.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 1. Android async http 的 get 和 post 请求方式的使用</span><br><span class="line"> * 2. Android async http 回调逻辑的二次封装</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">BaseActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="comment">//asyncHttpGet();</span></span><br><span class="line">        asyncHttpPost();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">asyncHttpGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        AsyncHttpClient client = <span class="keyword">new</span> AsyncHttpClient();</span><br><span class="line">        String URL = <span class="string">"http://apis.juhe.cn/mobile/get?phone=18796150250&amp;key=af9bfc2857ad3522db215dee9026084f"</span>;</span><br><span class="line">        client.get(URL, <span class="keyword">new</span> AsyncHttpResponseHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(<span class="keyword">int</span> statusCode, Header[] headers, <span class="keyword">byte</span>[] responseBody)</span> </span>&#123;</span><br><span class="line">                showToast(<span class="string">"请求成功"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(<span class="keyword">int</span> statusCode, Header[] headers, <span class="keyword">byte</span>[] responseBody, Throwable error)</span> </span>&#123;</span><br><span class="line">                showToast(<span class="string">"请求失败"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    private void asyncHttpPost() &#123;</span></span><br><span class="line">    <span class="comment">//        AsyncHttpClient client = new AsyncHttpClient();</span></span><br><span class="line">    <span class="comment">//        String URL = "http://apis.juhe.cn/mobile/get?";</span></span><br><span class="line">    <span class="comment">//        RequestParams params = new RequestParams();</span></span><br><span class="line">    <span class="comment">//        params.put("phone", "18796150250");</span></span><br><span class="line">    <span class="comment">//        params.put("key", "af9bfc2857ad3522db215dee9026084f");</span></span><br><span class="line">    <span class="comment">//        client.post(</span></span><br><span class="line">    <span class="comment">//                URL,</span></span><br><span class="line">    <span class="comment">//                params,</span></span><br><span class="line">    <span class="comment">//                new AsyncHttpResponseHandler() &#123;</span></span><br><span class="line">    <span class="comment">//                    @Override</span></span><br><span class="line">    <span class="comment">//                    public void onSuccess(int statusCode, Header[] headers, byte[] responseBody) &#123;</span></span><br><span class="line">    <span class="comment">//                        showToast(responseBody.toString());// 测试一下</span></span><br><span class="line">    <span class="comment">//                    &#125;</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//                    @Override</span></span><br><span class="line">    <span class="comment">//                    public void onFailure(int statusCode, Header[] headers, byte[] responseBody, Throwable error) &#123;</span></span><br><span class="line">    <span class="comment">//                        showToast("获取失败");</span></span><br><span class="line">    <span class="comment">//                    &#125;</span></span><br><span class="line">    <span class="comment">//                &#125;</span></span><br><span class="line">    <span class="comment">//        );</span></span><br><span class="line">    <span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自己二次封装</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">asyncHttpPost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String URL = <span class="string">"http://apis.juhe.cn/mobile/get?"</span>;</span><br><span class="line">        RequestParams params = <span class="keyword">new</span> RequestParams();</span><br><span class="line">        params.put(<span class="string">"phone"</span>, <span class="string">"18796150250"</span>);</span><br><span class="line">        params.put(<span class="string">"key"</span>, <span class="string">"af9bfc2857ad3522db215dee9026084f"</span>);</span><br><span class="line">        RequestUtils.clientPost(URL, params, <span class="keyword">new</span> NetCallback() &#123;</span><br><span class="line">            <span class="comment">// 实现自定义的回调</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMySuccess</span><span class="params">(<span class="keyword">int</span> statusCode)</span> </span>&#123;</span><br><span class="line">                showToast(statusCode + <span class="string">""</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMyFailure</span><span class="params">(Throwable error)</span> </span>&#123;</span><br><span class="line">                showToast(<span class="string">"请求失败"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setupData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        setContentView(R.layout.activity_main, R.string.app_name, MODE_NO_ICON);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>RequestUtils.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * Description: 请求方法类</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AsyncHttpClient client = <span class="keyword">new</span> AsyncHttpClient();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">clientGet</span><span class="params">(String url, NetCallback cb)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        client.get(url, cb);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">clientPost</span><span class="params">(String url, RequestParams params, NetCallback cb)</span> </span>&#123;</span><br><span class="line">        client.post(url, params, cb);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>NetCallback.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">NetCallback</span> <span class="keyword">extends</span> <span class="title">AsyncHttpResponseHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"info .... "</span>,<span class="string">"请求开始，弹出进度条对话框"</span>);</span><br><span class="line">        <span class="keyword">super</span>.onStart();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(<span class="keyword">int</span> statusCode, Header[] headers, <span class="keyword">byte</span>[] responseBody)</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"info .... "</span>,<span class="string">"请求成功，隐藏进度条对话框"</span> + statusCode);</span><br><span class="line">        onMySuccess(statusCode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(<span class="keyword">int</span> statusCode, Header[] headers, <span class="keyword">byte</span>[] responseBody, Throwable error)</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"info .... "</span>,<span class="string">"请求失败，隐藏进度条对话框"</span> + statusCode);</span><br><span class="line">        onMyFailure(error);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onMySuccess</span><span class="params">(<span class="keyword">int</span> statusCode)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onMyFailure</span><span class="params">(Throwable error)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>End.</p>
<p>Note by <a href="http://isayes.github.io" target="_blank" rel="external">HF</a>.  </p>
<hr>
<p>本文标签：<a href="http://isayes.github.io/categories/android" target="_blank" rel="external">Android</a></p>

      
    </div>
    <footer>
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>
<!-- hackish -->

  
</div>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2017 HuFei
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="http://apps.bdimg.com/libs/fancybox/2.1.5/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>