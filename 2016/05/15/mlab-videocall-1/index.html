<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title># 有关时间同步的问题 | Notes.HF</title>
  <meta name="author" content="HuFei">
  
  <meta name="description" content="Notes of Daily Learning">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="# 有关时间同步的问题"/>
  <meta property="og:site_name" content="Notes.HF"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Notes.HF" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>

<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Notes.HF</a></h1>
  <h2><a href="/">notes of buaaGS1521AA9.hufei | 用来笔记一下</a></h2>
</div>
<nav id="main-nav">
  <ul>
    
      <li><a href="/more">分类</a></li>
    
      <li><a href="/works">作品</a></li>
    
      <li><a href="http://www.cnblogs.com/isayes">博客</a></li>
    
      <li><a href="http://weibo.com/khufly">微博</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
<div class="alignleft" style="margin-top: 15px">


  <iframe src="http://ghbtns.com/github-btn.html?user=Isayes&type=follow"
  allowtransparency="true" frameborder="0" scrolling="0" width="132" height="20"></iframe>

</div>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="wrapper"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
  
    <h1 class="title"># 有关时间同步的问题</h1>
  

      
        <p class="published">
          Published: <time datetime="2016-05-15T10:51:07.000Z">2016-05-15</time>
        </p>
      
    </header>
    <div class="entry">
      
        <p>关键词：NTP / 时间同步 / 时间服务器</p>
<p>客户端获取到时间同步服务器的时间后，加上传输时延，为当前的同步服务器时间。<a id="more"></a></p>
<h2 id="1-什么是-NTP"><a href="#1-什么是-NTP" class="headerlink" title="1. 什么是 NTP #"></a>1. 什么是 NTP #</h2><p>NTP 是网络时间协议(Network Time Protocol)，它是用来同步网络中各个计算机的时间的协议。<br>在计算机的世界里，时间非常的重要，例如对于火箭发射这种科研活动，对时间的统一性和准确性要求就非常的高，是按照 A  这台计算机的时间，还是按照 B 这台计算机的时间？NTP 就是用来解决这个问题的，NTP（Network Time Protocol，网络时间协议）是用来使网络中的各个计算机时间同步的一种协议。它的用途是把计算机的时钟同步到世界协调时 UTC，其精度在局域网内可达 0.1ms，在互联网上绝大多数的地方其精度可以达到 1-50ms。<br>它可以使计算机对其服务器或时钟源（如石英钟，GPS 等等）进行时间同步，它可以提供高精准度的时间校正，而且可以使用加密确认的方式来防止恶毒的协议攻击。</p>
<h2 id="2-获取音视频时间序列"><a href="#2-获取音视频时间序列" class="headerlink" title="2. 获取音视频时间序列 #"></a>2. 获取音视频时间序列 #</h2><p>（1）自己搭的时间同步服务器，拨打方先给服务器发消息获取服务器的时间戳，同时接收方发消息给服务器获取服务器的时间戳，获取后，再基于往返的时延，计算到当前的服务器时间，作为同步后的时间。</p>
<p><img src="http://ww3.sinaimg.cn/mw690/a53846c3gw1f3xgdachamj20an07aabb.jpg" alt=""></p>
<p>（2）采用国际或者国家同步服务器</p>
<p><img src="http://ww4.sinaimg.cn/mw690/a53846c3gw1f3xgdb87yzj20b607t3zv.jpg" alt=""></p>
<h2 id="3-时间同步服务器的地址收集"><a href="#3-时间同步服务器的地址收集" class="headerlink" title="3. 时间同步服务器的地址收集 #"></a>3. 时间同步服务器的地址收集 #</h2><p>一些教育网的:<br>1 s1a.time.edu.cn 北京邮电大学<br>1 s1b.time.edu.cn 清华大学<br>1 s1c.time.edu.cn 北京大学<br>1 s1d.time.edu.cn 东南大学<br>1 s1e.time.edu.cn 清华大学<br>2 s2a.time.edu.cn 清华大学<br>2 s2b.time.edu.cn 清华大学<br>2 s2c.time.edu.cn 北京邮电大学<br>2 s2d.time.edu.cn 西南地区网络中心<br>2 s2e.time.edu.cn 西北地区网络中心<br>2 s2f.time.edu.cn 东北地区网络中心<br>2 s2g.time.edu.cn 华东南地区网络中心<br>2 s2h.time.edu.cn 四川大学网络管理中心<br>2 s2j.time.edu.cn 大连理工大学网络中心<br>2 s2k.time.edu.cn CERNET桂林主节点<br>2 s2m.time.edu.cn 北京大学  </p>
<p>国外的:<br>time.windows.com<br>time.nist.gov<br>pool.ntp.org  </p>
<p>NTP 网络时间服务器：<a href="http://www.xbd-time.com" target="_blank" rel="external">http://www.xbd-time.com</a><br>GPS 北斗同步时钟：<a href="http://www.xbd-time.com" target="_blank" rel="external">http://www.xbd-time.com</a><br>ntp 网络时间同步服务器：<a href="http://www.xbd-time.com" target="_blank" rel="external">http://www.xbd-time.com</a><br>GPS 北斗授时卡：<a href="http://www.xbd-time.com" target="_blank" rel="external">http://www.xbd-time.com</a><br>北斗时频技术有限责任公司：<a href="http://www.xbd-time.com" target="_blank" rel="external">http://www.xbd-time.com</a><br>北斗时间频率技术有限公司研发的时间频率产品已经涵盖机架式、台式、便携式、手持式、卡式等多种产品类型。主要产品类别有 GPS 授时系统、北斗授时系统、GPS 时码发生器（GPS 时码器）、北斗时码发生器（北斗时码器）、GPS 授时卡（GPS 时统卡/时码卡）、北斗授时卡、PCI/CPCI 时码卡、IRIG-B 码编码解码卡、NTP 网络时间服务器、IEEE1588 （PTP）精密时钟、GPS 北斗同步时钟、GPS 铷原子钟（GPS 铷原子频标）、北斗铷原子钟（北斗铷原子频标）、频率分配放大器、频标无缝切换器、脉冲分配器、IRIG-B 时码分配器、高精度时间间隔计数器、高精度频率计、比相仪等。</p>
<h2 id="4-关键指标及其计算方法"><a href="#4-关键指标及其计算方法" class="headerlink" title="4. 关键指标及其计算方法 #"></a>4. 关键指标及其计算方法 #</h2><ol>
<li>视频清晰度：<br>调用 AnyChat 平台接口获取；</li>
<li>视频丢帧次数：<br>公式：<code>丢帧次数 = 帧率 * 时间 - 累计帧数</code>；累计帧数：可以是基于平台接口计算已收到的累计帧数；时间：记录通话开始时间戳，与当前的时间戳的差记作通话时间；帧率：通过平台接口获得系统设置的帧率；</li>
<li>视频卡顿时延：<br>公式：<code>卡顿时延 = 丢帧次数 / 帧率</code>；得到丢帧次数以及帧率，其比值便是卡顿时延；</li>
<li>视频马赛克次数：<br>打马赛克的过程就是将相邻的几个像素点设置成其均值或者中值，而真实的图像中几乎不会出现相邻几个像素点相等的情况，基于此，我们在获得每一帧的 bitmap 的同时，根据相邻四个像素点相等来判断一个马赛克的方法，得到累计的马赛克次数；</li>
<li>音频时延：<br>通过消息将音频帧的发送时间戳带给音频帧接收方，接收方通过接收时间戳计算每一个帧的时延（单向）；</li>
<li>音频抖动：<br>基于音频的时延序列计算抖动；</li>
<li>音频丢包率：<br>调用 AnyChat 平台接口获取；</li>
<li>音视频不同步次数：<br>通过消息获取音视频帧的发送和接收时间戳序列，再进行比较获取音视频不同步次数；</li>
<li>音视频不同步时延：<br>通过消息获取音视频帧的发送和接收时间戳序列，再计算不同步时延；</li>
<li>音视频交互时延：<br>通过消息获取音视频帧的发送和接收时间戳序列，再计算交互时延；</li>
</ol>
<p>End.</p>
<p>Note by <a href="http://isayes.github.io" target="_blank" rel="external">HF</a>.  </p>

      
    </div>
    <footer>
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>
<!-- hackish -->

  
</div>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2017 HuFei
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="http://apps.bdimg.com/libs/fancybox/2.1.5/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>