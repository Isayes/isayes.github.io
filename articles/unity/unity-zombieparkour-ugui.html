<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title># 实现僵尸跑酷游戏的 UGUI 实践 | Notes.HF</title>
  <meta name="author" content="HuFei">
  
  <meta name="description" content="Notes of Daily Learning">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="# 实现僵尸跑酷游戏的 UGUI 实践"/>
  <meta property="og:site_name" content="Notes.HF"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Notes.HF" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>

<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Notes.HF</a></h1>
  <h2><a href="/">notes of buaaGS1521AA9.hufei | 用来笔记一下</a></h2>
</div>
<nav id="main-nav">
  <ul>
    
      <li><a href="/more">分类</a></li>
    
      <li><a href="/works">作品</a></li>
    
      <li><a href="http://blog.csdn.net/heartyhu">CSDN</a></li>
    
      <li><a href="http://weibo.com/khufly">微博</a></li>
    
      <li><a href="/poem">诗</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
<div class="alignleft" style="margin-top: 15px">


  <iframe src="http://ghbtns.com/github-btn.html?user=Isayes&type=follow"
  allowtransparency="true" frameborder="0" scrolling="0" width="132" height="20"></iframe>

</div>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="wrapper"><article class="page">
  
  <div class="post-content">
    <header>
      
  
    <h1 class="title"><a href="/articles/unity/unity-zombieparkour-ugui.html"># 实现僵尸跑酷游戏的 UGUI 实践</a></h1>
  

      
    </header>
    <div class="entry">
      
        <p>博客园同步 :  <a href="http://www.cnblogs.com/isayes/p/6380457.html" target="_blank" rel="external">http://www.cnblogs.com/isayes/p/6380457.html</a></p>
<h2 id="0-对本次实践的介绍"><a href="#0-对本次实践的介绍" class="headerlink" title="0. 对本次实践的介绍 #"></a>0. 对本次实践的介绍 #</h2><p>学习 Unity 5.x 原生态 UGUI 的开发实践, 学习参考自 58 开发网, 这是一个跑酷类游戏的 UI 界面, 包含了游戏开始的 主界面|主角的 UI 设置|时间 UI 设置以及所获得的金币 UI 设置等. 通过此次实践可以了解到以下内容, 对 UGUI 有一个深入的认识 :</p>
<ul>
<li>Sprite 资源导入及切割</li>
<li>制作主界面欢迎文字</li>
<li>制作主界面开始|退出按钮</li>
<li>制作人物 HUD 和金币 HUD 和时间 HUD</li>
<li>CanvasGroup 的使用</li>
<li>UI 动画制作及显示</li>
<li>实现金币 UI 数量显示功能</li>
<li>实现生命数量 UI 更新功能</li>
<li>实现时间倒计时功能</li>
<li>UI 自适应调整</li>
</ul>
<p>想要实现的效果</p>
<p><img src="http://wx1.sinaimg.cn/mw690/a53846c3gy1fcj75b32hqg20gr08xe81.gif?_=6380457" alt=""></p>
<h2 id="1-Sprite-资源导入及切割"><a href="#1-Sprite-资源导入及切割" class="headerlink" title="1. Sprite 资源导入及切割 #"></a>1. Sprite 资源导入及切割 #</h2><p>UISprites.psd</p>
<p><img src="http://wx4.sinaimg.cn/mw690/a53846c3gy1fchz4g4hjnj20o20ds0un.jpg" alt=""></p>
<p>把准备好的素材 UISprites.psd 导入项目, 检查 <code>Texture Type</code> 的类型是 <code>Sprite(2D and UI)</code> 模式, <code>Sprite Mode</code> 改成 <code>Multiple</code>, 进而 <code>Apply</code> 一下.</p>
<p><img src="http://wx2.sinaimg.cn/mw690/a53846c3gy1fchz4hfi93j20l40hg76o.jpg" alt=""></p>
<p>点击进入 <code>Sprite Editor</code> 精灵的编辑器.</p>
<p><img src="http://wx3.sinaimg.cn/mw690/a53846c3gy1fchz4h0m9mj20m80hyae6.jpg" alt=""></p>
<p>在 Sprite Editor 左键圈住内容选择切割区域, <code>Apply</code> 一下便切割开了.</p>
<p><img src="http://wx1.sinaimg.cn/mw690/a53846c3gy1fchz4ijekfj20vi0kq7ag.jpg" alt=""></p>
<p>切割之前与切割之后的项目目录对比 :</p>
<p><img src="http://wx2.sinaimg.cn/mw690/a53846c3gy1fchz4ghk8lj20cu06ijrs.jpg" alt=""> 和 <img src="http://wx3.sinaimg.cn/mw690/a53846c3gy1fchz4hz1l5j20cu0bwwfl.jpg" alt=""></p>
<h2 id="2-制作主界面欢迎文字"><a href="#2-制作主界面欢迎文字" class="headerlink" title="2. 制作主界面欢迎文字 #"></a>2. 制作主界面欢迎文字 #</h2><p>新建一个 <code>Canvas&gt;Image</code>, 把切好的 UISprites 的 Title 作为 <code>Source Image</code> 给它. 调整大小和位置.</p>
<p>修改文字锚点的位置, 保持四个角的相对位置, 使之自适应屏幕大小的改变.</p>
<p><img src="http://wx2.sinaimg.cn/mw690/a53846c3gy1fchz4jxzboj20r40aaab6.jpg" alt="">  </p>
<p>改成</p>
<p><img src="http://wx3.sinaimg.cn/mw690/a53846c3gy1fchz4j13jyj20rk0a4gmt.jpg" alt=""></p>
<p>在 <code>Image</code> Title 下添加文字 <code>Text</code>, 修改内容和字体等格式, 选中 <code>Best Fit</code>, 同样, 也需要修改其锚点.</p>
<p>欢迎界面就做好了.</p>
<p><img src="http://wx4.sinaimg.cn/mw690/a53846c3gy1fchz4kb1bfj20og0q8tcr.jpg" alt=""></p>
<h2 id="3-制作主界面开始-退出按钮"><a href="#3-制作主界面开始-退出按钮" class="headerlink" title="3. 制作主界面开始|退出按钮 #"></a>3. 制作主界面开始|退出按钮 #</h2><p><code>Canvas</code> 下面创建3个 <code>Button</code>, 分别对应为 <code>Start</code> | <code>Options</code> | <code>Exit</code>, 关联 <code>Source Image</code> 以及修改背景颜色和文字</p>
<p><img src="http://wx3.sinaimg.cn/mw690/a53846c3gy1fchz4l0pqlj20c007et8y.jpg" alt=""></p>
<p>界面效果</p>
<p><img src="http://wx3.sinaimg.cn/mw690/a53846c3gy1fchz4llz8zj20ug0skn2s.jpg" alt=""></p>
<h2 id="4-制作人物-HUD-和金币-HUD-和时间-HUD"><a href="#4-制作人物-HUD-和金币-HUD-和时间-HUD" class="headerlink" title="4. 制作人物 HUD 和金币 HUD 和时间 HUD#"></a>4. 制作人物 HUD 和金币 HUD 和时间 HUD#</h2><p>添加一个新的 Canvas 里面有一个 Image 和两个 Text, 如下图所示</p>
<p><img src="http://wx1.sinaimg.cn/mw690/a53846c3gy1fcidv0r2foj20ka0ci0tc.jpg" alt=""></p>
<p>为了适应屏幕, 将 Image 的 Rect Transform 设置为 <code>left + top</code></p>
<p><img src="http://wx1.sinaimg.cn/mw690/a53846c3gy1fcidtgcm9gj208407odg5.jpg" alt=""></p>
<p>Coin 的图标同理, 锚点设为 <code>right + top</code>.</p>
<p>新建 <code>Create Empty</code> 添加时间轴图片, 操作同上, 最终效果</p>
<p><img src="http://wx1.sinaimg.cn/mw690/a53846c3gy1fcidv4dzvrj20m00e00tt.jpg" alt=""></p>
<h2 id="5-CanvasGroup-的使用"><a href="#5-CanvasGroup-的使用" class="headerlink" title="5. CanvasGroup 的使用 #"></a>5. CanvasGroup 的使用 #</h2><p>在 <code>MainMenuCanvas</code> 里新建一个 <code>Create Empty</code> 作为其他对象的父物体, 即 <code>Title StartBtn OptionsBtn ExitBtn</code> 都属于同一个 GameObject 命名为 <code>MainMenu</code>, 这个 MainMenu 的锚点设为 <code>Stretch - Stretch</code>.</p>
<p>为 <code>MainMenu</code> Add Component 添加 CanvasGroup 组件, 可以通过控制他的 Alpha 通道来显示或者隐藏界面</p>
<p>同理, 把原先的 MainMenuCanvas 重命名为 Canvas, 给其增加一个 HUD 用于放置原先的 Canvas 的子物体.增加 CanvasGroup, 可以通过控制他的 Alpha 通道来显示或者隐藏界面</p>
<p>上述描述的结果如下图所示</p>
<p><img src="http://wx3.sinaimg.cn/mw690/a53846c3gy1fcidw7o140j20cu09udgf.jpg" alt=""></p>
<p>MainMenu 的 <code>CanvasGroup&gt;Alpha</code> 初始化为 1, HUD 的 <code>CanvasGroup&gt;Alpha</code> 初始化为 0.</p>
<p>给 StartBtn 按钮的 <code>On Click()</code> 添加事件通知 MainMenu 上面的 Alpha 属性值置为 0, 再添加一个事件通知 HUD 的 Alpha 属性值置为 1.</p>
<p><img src="http://wx2.sinaimg.cn/mw690/a53846c3gy1fcidwu7cmqj20u40eqq87.jpg" alt=""></p>
<p><img src="http://wx3.sinaimg.cn/mw690/a53846c3gy1fcidwybupjj20qy07ejs4.jpg" alt=""></p>
<p>动图效果</p>
<p><img src="http://wx1.sinaimg.cn/mw690/a53846c3gy1fcidr2l9qjg20gz08lwjd.gif" alt=""></p>
<h2 id="6-UI-动画制作及显示"><a href="#6-UI-动画制作及显示" class="headerlink" title="6. UI 动画制作及显示 #"></a>6. UI 动画制作及显示 #</h2><p>但是界面的切换有点生硬, 最好使用一下 UI 的动画制作, 使显示的更自然.</p>
<p>打开 <code>Window&gt;Animation</code> 编辑器, 为 MainMenu 创建一个 Animator 和 一个 <code>Animation Clip</code>. Add Property <code>MainMenu : Canvas Group.Alpha</code> 范围设为动画的<code>0~1</code>对应其<code>1~0</code></p>
<p><img src="http://wx2.sinaimg.cn/mw690/a53846c3gy1fcj1202wj5g20ig0460ur.gif" alt=""></p>
<p>默认的 <code>Animator</code> 设置为只动画一次, 不要循环 : 把 <code>MainMenuFadeOut</code> 的 <code>Loop Time</code> 的勾选去掉.</p>
<p><img src="http://wx1.sinaimg.cn/mw690/a53846c3gy1fcj1209s4qj20xg0cognk.jpg" alt=""></p>
<p>实现 HUD 的动画操作类似.</p>
<p>为了有更好的衔接效果, 最好给 Animator 里做个过渡, 即可以添加一个 <code>Create Empty New State</code> 作为默认的 <code>Default State</code> 再由它 <code>Make Transition</code> 到原有的 <code>MainMenuFadeOut</code>. HUD 操作同理</p>
<p><img src="http://wx3.sinaimg.cn/mw690/a53846c3gy1fcj120dkepj21040hy76z.jpg" alt=""></p>
<p>触发相关 Trigger 的过程如下, 点击 Start 按钮触发 MainMenu 的 <code>FadeOut</code> 使之淡出, 紧接着也触发 HUD 的 <code>FadeIn</code> 使之淡入, 这样就做好了. 对 Trigger 的控制需要脚本. 脚本内容如下</p>
<p><strong>脚本 MainMenuController</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MainMenuController</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Animator mainMenuAnim;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		mainMenuAnim = GetComponent&lt;Animator&gt; ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MenuFade</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		mainMenuAnim.SetTrigger (<span class="string">"FadeOut"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>脚本 HudController</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HudController</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Animator hudAnim;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		hudAnim = GetComponent&lt;Animator&gt; ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">HudFade</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		hudAnim.SetTrigger (<span class="string">"FadeIn"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>让 <code>StartBtn</code> 删除原来的事件, 换成与上述脚本绑定的 <code>OnClick()</code> 事件</p>
<p><img src="http://wx3.sinaimg.cn/mw690/a53846c3gy1fcj1216d9fj20ic0a0js8.jpg" alt=""></p>
<p>至此, 渐出渐入的动画效果就做好了. 效果如下所示 :</p>
<p><img src="http://wx4.sinaimg.cn/mw690/a53846c3gy1fcj11n8do9g20ig0fph4k.gif" alt=""></p>
<h2 id="7-实现金币-UI-数量显示功能"><a href="#7-实现金币-UI-数量显示功能" class="headerlink" title="7. 实现金币 UI 数量显示功能 #"></a>7. 实现金币 UI 数量显示功能 #</h2><p>实现界面右上角金币的数量逻辑.</p>
<p>找到 <code>HUD&gt;CoinsUI&gt;TexCoinsCount</code> 添加一个 CoinCounter.cs 脚本.</p>
<p>僵尸吃硬币就是僵尸与金币进行碰撞, 每吃一个硬币就使右上角加1. 硬币 Coin 脚本 :</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Coin</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">private</span> CoinCounter coinCounter;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		coinCounter = GameObject.FindGameObjectWithTag (<span class="string">"TextCoinsCount"</span>).GetComponent&lt;CoinCounter&gt; ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnTriggerEnter2D</span>(<span class="params">Collider2D other</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(other.gameObject.tag == <span class="string">"Player"</span>)</span><br><span class="line">			print (<span class="string">"You picked up a coin!"</span>);</span><br><span class="line"></span><br><span class="line">		coinCounter.coinCount++;</span><br><span class="line">		gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>脚本 CoinCounter</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CoinCounter</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> coinCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		GetComponent&lt;Text&gt;().text = coinCount.ToString ();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如图所示</p>
<p><img src="http://wx3.sinaimg.cn/mw690/a53846c3gy1fcj3rz58khg20ig08d4qp.gif" alt=""></p>
<h2 id="8-实现生命数量-UI-更新功能"><a href="#8-实现生命数量-UI-更新功能" class="headerlink" title="8. 实现生命数量 UI 更新功能 #"></a>8. 实现生命数量 UI 更新功能 #</h2><p>硬币收集到一定数量就增加一个生命值的数量, 当收满 24 个金币的时候就会增加一条命.</p>
<p><img src="http://wx4.sinaimg.cn/mw690/a53846c3gy1fcj75bodt3j211q0jegq5.jpg" alt=""></p>
<p><strong>脚本 LivesCounter</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line">[ExecuteInEditMode]</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LivesCounter</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> initialLives = <span class="number">3</span>; <span class="comment">// 游戏刚开始的时候的生命数量</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> extraLives = <span class="number">0</span>; <span class="comment">// 游戏进行时额外增加的生命数量</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> totalLives; <span class="comment">// 主角生命数量的总数</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		GetLives();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Update is called once per frame</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		totalLives = initialLives + extraLives;</span><br><span class="line">		GetComponent&lt;Text&gt; ().text = totalLives.ToString ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">GetLives</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		totalLives = initialLives + extraLives;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>脚本 GameState</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameState</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">private</span> GameObject[] coins;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> totalCoins; <span class="comment">// 所有的金币总数</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">bool</span> gameRunning = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> CoinCounter coinCounter;</span><br><span class="line">	<span class="keyword">private</span> LivesCounter liveCounter;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Awake</span> (<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		coinCounter = GameObject.FindGameObjectWithTag (<span class="string">"TextCoinsCount"</span>).GetComponent&lt;CoinCounter&gt; ();</span><br><span class="line">		liveCounter = GameObject.FindGameObjectWithTag (<span class="string">"TextLiveCount"</span>).GetComponent&lt;LivesCounter&gt; ();</span><br><span class="line"></span><br><span class="line">		coins = GameObject.FindGameObjectsWithTag(<span class="string">"Coin"</span>);</span><br><span class="line">		totalCoins = coins.Length;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">int</span> collectedCoins;</span><br><span class="line">		collectedCoins = coinCounter.coinCount; <span class="comment">// 当前收集到的金币数量</span></span><br><span class="line">		liveCounter.extraLives = collectedCoins / totalCoins;</span><br><span class="line">		<span class="keyword">if</span> (liveCounter.totalLives &lt; <span class="number">0</span>) &#123;</span><br><span class="line">			print (<span class="string">"Game Over!"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">StartGame</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		gameRunning = <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GameOver</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		gameRunning = <span class="literal">false</span>;</span><br><span class="line">		print (<span class="string">"Game Over!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-实现时间倒计时功能"><a href="#9-实现时间倒计时功能" class="headerlink" title="9. 实现时间倒计时功能 #"></a>9. 实现时间倒计时功能 #</h2><p>也就是界面最上方中间的时间计数器的逻辑实现.</p>
<p>随着时间的流逝, 上面的颜色池减少. (图片由右向左的长度的减少), 把 <code>TimerFillImage</code> 的 <code>Image Type</code> 换成 Filled, 并且将 <code>Fill Method</code> 设置为 Horizontal, 那么 <code>Fill Amount</code> 就可以用来做计时了.</p>
<p>为 <code>Canvas&gt;HUD&gt;Timer&gt;TimerFillImage</code> 新建脚本 Timer.cs</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Timer</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> currentTimer;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> startTimer = <span class="number">10</span>f;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> timerPercent;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Image image;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Awake</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		currentTimer = startTimer;</span><br><span class="line">		image = GetComponent&lt;Image&gt; ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="comment">// 计时</span></span><br><span class="line">		currentTimer -= Time.deltaTime;</span><br><span class="line">		timerPercent = currentTimer / startTimer;</span><br><span class="line">		image.fillAmount = timerPercent;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如图所示</p>
<p><img src="http://wx4.sinaimg.cn/mw690/a53846c3gy1fcj756frtjg20bj03h0sx.gif" alt=""></p>
<p>但是有一点需要注意, 那就是只有当 StartBtn 被点击出现新界面之后才应该开始计时. 需要利用在 GameState.cs 里的 gameRunning 状态, 在 Timer.cs 中把 gameRunning 读取过来, 是否开始进行一下控制. 当然,还不能忘记了, 还需要给 StartBtn 再增加一个 点击事件的反馈, 即去调用 GameState.cs 里的 StartGame() 方法.</p>
<p><img src="http://wx2.sinaimg.cn/mw690/a53846c3gy1fcj75coy2cj20l80a03zj.jpg" alt=""></p>
<p>看看 Timer.cs 脚本的改进</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Timer</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> currentTimer;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> startTimer = <span class="number">10</span>f;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> timerPercent;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Image image;</span><br><span class="line">	<span class="keyword">private</span> GameState gameState;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Awake</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		currentTimer = startTimer;</span><br><span class="line">		image = GetComponent&lt;Image&gt; ();</span><br><span class="line">		gameState = GameObject.Find (<span class="string">"GameState"</span>).GetComponent&lt;GameState&gt; ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="comment">// 游戏的确开始在运行的时候才开始进行倒计时</span></span><br><span class="line">		<span class="keyword">if</span>(gameState.gameRunning)&#123;</span><br><span class="line">			<span class="comment">// 计时</span></span><br><span class="line">			currentTimer -= Time.deltaTime;</span><br><span class="line">			timerPercent = currentTimer / startTimer;</span><br><span class="line">			image.fillAmount = timerPercent;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>目前为止的效果</p>
<p><img src="http://wx1.sinaimg.cn/mw690/a53846c3gy1fcj75b32hqg20gr08xe81.gif" alt=""></p>
<h2 id="10-UI-自适应调整"><a href="#10-UI-自适应调整" class="headerlink" title="10. UI 自适应调整 #"></a>10. UI 自适应调整 #</h2><p>即需要调整锚点的地方就调整一下.</p>
<hr>
<p><code>学习自 58 开发网视频教程 : http://www.58kaifa.com/course/35</code></p>
<p>End.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>
<!-- hackish -->
</div>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2017 HuFei
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="http://apps.bdimg.com/libs/fancybox/2.1.5/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>